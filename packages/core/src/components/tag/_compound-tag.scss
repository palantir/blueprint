// Copyright 2024 Palantir Technologies, Inc. All rights reserved.
// Licensed under the Apache License, Version 2.0.

@import "../../common/variables";
@import "../../common/variables-extended";
@import "../../common/mixins";
@import "./common";

/*
Compound Tags
*/

// some of these values are copied from _common.scss, but our mixins have a different shape here
$compound-tag-key-default-colors: ($dark-gray5, $dark-gray4, $dark-gray3) !default;
$compound-tag-value-default-colors: ($gray1, $dark-gray5, $dark-gray4) !default;
$dark-compound-tag-key-default-colors: ($gray4, $gray3, $gray2) !default;
$dark-compound-tag-value-default-colors: ($gray5, $gray4, gray3) !default;

// one shade darker than $tag-intent-colors
$compound-tag-key-intent-colors: (
  "primary": ($blue2, $blue1, $blue0),
  "success": ($green2, $green1, $green0),
  "warning": ($orange4, $orange3, $orange2),
  "danger": ($red2, $red1, $red0),
) !default;

@mixin compound-tag-colors(
  /* each list is a (default, hover, active) tuple of background colors */
  $key-colors,
  $value-colors
) {
  // override default tag background styles: this is important for minimal tags with opacity values
  // which we want to define _absolutely_ in our design system and not by stacking opacities on top of each other.
  background: none;

  .#{$ns}-compound-tag-key {
    background-color: nth($key-colors, 1);
  }

  .#{$ns}-compound-tag-value {
    background-color: nth($value-colors, 1);
  }

  &.#{$ns}-interactive {
    &:hover {
      .#{$ns}-compound-tag-key {
        background-color: nth($key-colors, 2);
      }

      .#{$ns}-compound-tag-value {
        background-color: nth($value-colors, 2);
      }
    }

    &:active,
    &.#{$ns}-active {
      .#{$ns}-compound-tag-key {
        background-color: nth($key-colors, 3);
      }

      .#{$ns}-compound-tag-value {
        background-color: nth($value-colors, 3);
      }
    }
  }
}

@mixin minimal-compound-tag-colors($base-color) {
  $key-colors: (rgba($base-color, 0.2), rgba($base-color, 0.3), rgba($base-color, 0.4));
  $value-colors: (rgba($base-color, 0.1), rgba($base-color, 0.2), rgba($base-color, 0.3));

  @include compound-tag-colors($key-colors, $value-colors);
}

@mixin dark-minimal-compound-tag-colors($base-color) {
  $key-colors: (rgba($base-color, 0.4), rgba($base-color, 0.5), rgba($base-color, 0.55));
  $value-colors: (rgba($base-color, 0.2), rgba($base-color, 0.3), rgba($base-color, 0.35));

  @include compound-tag-colors($key-colors, $value-colors);
}

.#{$ns}-compound-tag {
  // Variants: default & interactive
  @include compound-tag-colors(
    $compound-tag-key-default-colors,
    $compound-tag-value-default-colors
  );
  padding: 0;

  // Layout
  .#{$ns}-compound-tag-key,
  .#{$ns}-compound-tag-value {
    padding: 2px 4px;
  }

  .#{$ns}-compound-tag-key {
    // override pt-tag() pt-flex-container() style
    margin-right: 0;

    > #{$icon-classes} {
      margin-right: 4px;
    }
  }

  .#{$ns}-compound-tag-value {
    align-items: center;
    display: flex; // support "remove" button
    flex-grow: 1;
    padding: 2px 4px;

    > #{$icon-classes} {
      margin-left: 4px;
    }

    .#{$ns}-compound-tag-value-text {
      flex-grow: 1;
    }

    .#{$ns}-tag-remove {
      margin-left: 2px;
      // overriding pt-tag-remove() style
      /* stylelint-disable-next-line declaration-no-important */
      margin-right: -4px !important;
    }
  }

  // Variant: round
  &.#{$ns}-round {
    $tag-round-horizontal-padding: ($tag-height * 0.5) - $tag-round-adjustment;
    padding: 0;

    .#{$ns}-compound-tag-key {
      border-bottom-left-radius: $tag-height;
      border-top-left-radius: $tag-height;
      padding-left: $tag-round-horizontal-padding;
    }

    .#{$ns}-compound-tag-value {
      border-bottom-right-radius: $tag-height;
      border-top-right-radius: $tag-height;
      padding-right: $tag-round-horizontal-padding;
    }
  }

  // Variant: large
  &.#{$ns}-large {
    padding: 0;

    .#{$ns}-compound-tag-key,
    .#{$ns}-compound-tag-value {
      padding: 5px 8px;
    }

    .#{$ns}-compound-tag-key {
      > #{$icon-classes} {
        margin-right: 7px;
      }
    }

    .#{$ns}-compound-tag-value {
      > #{$icon-classes} {
        margin-left: 7px;
      }
    }

    .#{$ns}-tag-remove {
      margin-left: 7px;
      // overriding pt-tag-remove() style
      /* stylelint-disable-next-line declaration-no-important */
      margin-right: -10px !important;
    }

    // Variant: large & round
    &.#{$ns}-round {
      $tag-round-horizontal-padding-large: ($tag-padding-large) + $tag-round-adjustment;
      padding: 0;

      .#{$ns}-compound-tag-key {
        border-bottom-left-radius: $tag-height-large;
        border-top-left-radius: $tag-height-large;
        padding-left: $tag-round-horizontal-padding-large;
      }

      .#{$ns}-compound-tag-value {
        border-bottom-right-radius: $tag-height-large;
        border-top-right-radius: $tag-height-large;
        padding-right: $tag-round-horizontal-padding-large;
      }
    }
  }

  &.#{$ns}-minimal {
    // Variants: minimal default & interactive
    &:not([class*="#{$ns}-intent-"]) {
      @include minimal-compound-tag-colors($gray1);
    }

    // Variant: minimal intent
    @each $intent, $color in $pt-intent-colors {
      &.#{$ns}-intent-#{$intent} {
        @include minimal-compound-tag-colors($color);
      }
    }
  }

  .#{$ns}-dark & {
    // Variants: dark default & interactive
    @include compound-tag-colors(
      $dark-compound-tag-key-default-colors,
      $dark-compound-tag-value-default-colors
    );

    // Variant: dark intent
    // colors are identical to light theme, so we don't need any styles here

    &.#{$ns}-minimal {
      // Variants: dark minimal default & interactive
      &:not([class*="#{$ns}-intent-"]) {
        @include dark-minimal-compound-tag-colors($gray1);
      }

      // Variant: dark minimal intent
      @each $intent, $color in $pt-intent-colors {
        &.#{$ns}-intent-#{$intent} {
          @include dark-minimal-compound-tag-colors($color);
        }
      }
    }
  }

  // Important: these styles must come last to override dark theme default (no intent) styles
  // Variant: intent
  @each $intent, $key-colors in $compound-tag-key-intent-colors {
    &.#{$ns}-intent-#{$intent} {
      $value-colors: map-get($tag-intent-colors, $intent);

      @include compound-tag-colors($key-colors, $value-colors);
    }
  }
}
