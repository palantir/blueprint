#!/usr/bin/env bash

# glob of source files to lint
FILES="{src,test}/**/*.{ts,tsx}"

# convert relative path to absolute. in particular, resolves ~ character
absolute_path() {
  # $1 : relative filename
  echo "$(cd "$(dirname "$1")" && pwd)/$(basename "$1")"
}

if [[ -z $JUNIT_REPORT_PATH ]]; then
  # standard lint with friendly format
  tslint $FILES --format codeFrame $@
else
  # CI lint emits JUnit XML report file in <reports>/tslint/<pkg>.xml
  NAME=$(basename "$PWD")
  REPORT_DIR=$(absolute_path "$CIRCLE_WORKING_DIRECTORY/$JUNIT_REPORT_PATH")
  OUT="$REPORT_DIR/tslint/$NAME.xml"
  tslint $FILES --format junit --out $OUT $@
  echo "JUnit report written to $OUT"
fi
